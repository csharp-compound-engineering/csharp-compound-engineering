# ReportGenerator for .NET Code Coverage Visualization

## Research Summary

This document covers ReportGenerator integration for visualizing code coverage in a C# MCP server plugin project using Coverlet, xUnit, GitHub Actions, and GitHub Pages (Nextra).

---

## 1. ReportGenerator Basics

### What is ReportGenerator?

[ReportGenerator](https://github.com/danielpalme/ReportGenerator) is an open-source tool that converts code coverage reports generated by various tools into human-readable reports in multiple formats. It is maintained by Daniel Palme and is widely used in the .NET ecosystem.

**Key Features:**
- Converts coverage data to HTML, Markdown, JSON, XML, and other formats
- Supports history tracking to visualize coverage trends over time
- Generates SVG badges for README files
- Provides risk hotspot analysis
- Supports themes (light, dark, custom)
- Cross-platform (.NET Framework 4.7+ and .NET Core/8.0+)

### Supported Input Formats

ReportGenerator accepts coverage reports from:
- **Coverlet** (Cobertura XML, OpenCover, JSON, lcov)
- OpenCover
- dotCover
- Visual Studio Code Coverage
- NCover
- JaCoCo
- Clover
- gcov
- lcov

### Installation Methods

#### Global .NET Tool (Recommended)
```bash
# Install globally
dotnet tool install -g dotnet-reportgenerator-globaltool

# Or install locally in a project
dotnet new tool-manifest
dotnet tool install dotnet-reportgenerator-globaltool
```

#### NuGet Package
```xml
<PackageReference Include="ReportGenerator" Version="5.5.1" />
```

#### Verify Installation
```bash
reportgenerator --help
```

### Basic Usage
```bash
reportgenerator \
  -reports:"TestResults/**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:Html
```

**Official Documentation:**
- [ReportGenerator Website](https://reportgenerator.io/)
- [GitHub Repository](https://github.com/danielpalme/ReportGenerator)
- [Online Configuration Tool](https://reportgenerator.io/usage)

---

## 2. Integration with Coverlet

### Coverlet Overview

[Coverlet](https://github.com/coverlet-coverage/coverlet) is a cross-platform code coverage framework for .NET. It integrates seamlessly with xUnit, NUnit, and MSTest.

### Installing Coverlet

For xUnit test projects, add the collector package:

```xml
<PackageReference Include="coverlet.collector" Version="6.0.4" />
```

Or for MSBuild integration:
```xml
<PackageReference Include="coverlet.msbuild" Version="6.0.4" />
```

### Generating Cobertura XML Output

#### Using VSTest Integration (Recommended)
```bash
dotnet test --collect:"XPlat Code Coverage"
```

This generates `coverage.cobertura.xml` in `TestResults/{guid}/`.

#### Specifying Multiple Output Formats
```bash
dotnet test --collect:"XPlat Code Coverage;Format=cobertura,opencover,lcov"
```

#### Using runsettings for Advanced Configuration

Create a `coverlet.runsettings` file:

```xml
<?xml version="1.0" encoding="utf-8" ?>
<RunSettings>
  <DataCollectionRunSettings>
    <DataCollectors>
      <DataCollector friendlyName="XPlat code coverage">
        <Configuration>
          <Format>cobertura</Format>
          <Exclude>[*.Tests]*,[*]*.Generated*</Exclude>
          <Include>[MyProject.*]*</Include>
          <ExcludeByAttribute>Obsolete,GeneratedCodeAttribute,CompilerGeneratedAttribute</ExcludeByAttribute>
          <SingleHit>false</SingleHit>
          <UseSourceLink>true</UseSourceLink>
          <IncludeTestAssembly>false</IncludeTestAssembly>
          <SkipAutoProps>true</SkipAutoProps>
        </Configuration>
      </DataCollector>
    </DataCollectors>
  </DataCollectionRunSettings>
</RunSettings>
```

Run with runsettings:
```bash
dotnet test --settings coverlet.runsettings
```

### Consuming Cobertura XML with ReportGenerator

```bash
# After running tests with coverage
dotnet test --collect:"XPlat Code Coverage"

# Generate HTML report
reportgenerator \
  -reports:"**/TestResults/**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:"Html;HtmlSummary;Badges"
```

### Merging Multiple Coverage Reports

When you have multiple test projects:

```bash
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:Html
```

ReportGenerator automatically merges all matching coverage files.

---

## 3. GitHub Actions Integration

### Official ReportGenerator GitHub Action

The [ReportGenerator GitHub Action](https://github.com/marketplace/actions/reportgenerator) simplifies CI integration.

### Basic Workflow

```yaml
name: Build and Test with Coverage

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Restore dependencies
        run: dotnet restore

      - name: Build
        run: dotnet build --no-restore

      - name: Test with coverage
        run: dotnet test --no-build --collect:"XPlat Code Coverage"

      - name: Generate coverage report
        uses: danielpalme/ReportGenerator-GitHub-Action@5
        with:
          reports: '**/TestResults/**/coverage.cobertura.xml'
          targetdir: 'coveragereport'
          reporttypes: 'HtmlInline;Cobertura;Badges;MarkdownSummaryGithub'
          historydir: 'coveragehistory'

      - name: Upload coverage report
        uses: actions/upload-artifact@v4
        with:
          name: coverage-report
          path: coveragereport
```

### Action Input Parameters

| Parameter | Required | Description |
|-----------|----------|-------------|
| `reports` | Yes | Coverage file paths (glob patterns, semicolon-separated) |
| `targetdir` | Yes | Output directory for generated reports |
| `reporttypes` | No | Output formats (default: Html) |
| `sourcedirs` | No | Source code directories |
| `historydir` | No | Directory for coverage history |
| `assemblyfilters` | No | Include/exclude assembly patterns |
| `classfilters` | No | Include/exclude class patterns |
| `filefilters` | No | Include/exclude file patterns |
| `verbosity` | No | Log level (Verbose, Info, Warning, Error, Off) |
| `title` | No | Report title |
| `tag` | No | Build version/tag |
| `customSettings` | No | Additional settings |

### Adding Coverage Summary to PR Comments

```yaml
- name: Generate coverage report
  uses: danielpalme/ReportGenerator-GitHub-Action@5
  with:
    reports: '**/coverage.cobertura.xml'
    targetdir: 'coveragereport'
    reporttypes: 'HtmlInline;MarkdownSummaryGithub'

- name: Add coverage PR comment
  uses: marocchino/sticky-pull-request-comment@v2
  if: github.event_name == 'pull_request'
  with:
    recreate: true
    path: coveragereport/SummaryGithub.md
```

### Adding Coverage to Job Summary

```yaml
- name: Write coverage to job summary
  run: cat coveragereport/SummaryGithub.md >> $GITHUB_STEP_SUMMARY
```

---

## 4. GitHub Pages Publishing

### Approach 1: Deploy on Every Push to Main

Best for continuously updated coverage reports:

```yaml
name: Deploy Coverage to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Test with coverage
        run: dotnet test --collect:"XPlat Code Coverage"

      - name: Generate coverage report
        uses: danielpalme/ReportGenerator-GitHub-Action@5
        with:
          reports: '**/coverage.cobertura.xml'
          targetdir: 'coveragereport'
          reporttypes: 'Html;Badges'
          title: 'Code Coverage Report'

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'coveragereport'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### Approach 2: Deploy Per-Release to Versioned Subdirectories

Best for maintaining coverage history across releases:

```yaml
name: Deploy Release Coverage

on:
  release:
    types: [published]

permissions:
  contents: write

jobs:
  deploy-coverage:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Test with coverage
        run: dotnet test --collect:"XPlat Code Coverage"

      - name: Generate coverage report
        uses: danielpalme/ReportGenerator-GitHub-Action@5
        with:
          reports: '**/coverage.cobertura.xml'
          targetdir: 'coveragereport'
          reporttypes: 'Html;Badges;HtmlSummary'
          title: 'Coverage - ${{ github.event.release.tag_name }}'
          tag: '${{ github.event.release.tag_name }}'

      - name: Checkout gh-pages branch
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          path: gh-pages

      - name: Copy coverage to versioned directory
        run: |
          VERSION=${{ github.event.release.tag_name }}
          mkdir -p gh-pages/coverage/$VERSION
          cp -r coveragereport/* gh-pages/coverage/$VERSION/

          # Update latest symlink
          cd gh-pages/coverage
          rm -f latest
          ln -s $VERSION latest

      - name: Commit and push
        run: |
          cd gh-pages
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Add coverage for ${{ github.event.release.tag_name }}"
          git push
```

### Integrating with Nextra Documentation

For projects using Nextra for GitHub Pages documentation:

1. **Configure next.config.js for static export:**
```javascript
const withNextra = require('nextra')({
  theme: 'nextra-theme-docs',
  themeConfig: './theme.config.tsx',
});

module.exports = withNextra({
  output: 'export',
  basePath: process.env.BASE_PATH || '',
  images: {
    unoptimized: true,
  },
});
```

2. **Structure your docs to include coverage:**
```
docs/
  pages/
    index.mdx
    coverage/
      index.mdx  # Links to coverage reports
  public/
    coverage/    # Static coverage HTML goes here
      latest/
      v1.0.0/
      v1.1.0/
    .nojekyll    # Required for _next directory
```

3. **Reference coverage in documentation:**
```mdx
# Code Coverage

View the latest coverage report: [Coverage Report](/coverage/latest/index.html)

## Historical Reports
- [v1.1.0](/coverage/v1.1.0/index.html)
- [v1.0.0](/coverage/v1.0.0/index.html)
```

---

## 5. Configuration Options

### Report Types

| Report Type | Description |
|-------------|-------------|
| `Html` | Full HTML report with navigation |
| `Html_Light` | Light theme variant |
| `Html_Dark` | Dark theme variant |
| `Html_BlueRed` | Blue/red color scheme |
| `HtmlInline` | Single HTML with embedded CSS/JS (for CI) |
| `HtmlInline_AzurePipelines` | Adaptive theme for Azure DevOps |
| `HtmlSummary` | Single-page summary |
| `HtmlChart` | HTML with historical chart |
| `Badges` | SVG coverage badges |
| `Cobertura` | Cobertura XML (for other tools) |
| `MarkdownSummary` | Markdown summary |
| `MarkdownSummaryGithub` | GitHub-flavored markdown |
| `JsonSummary` | JSON format |
| `TextSummary` | Plain text summary |
| `SonarQube` | SonarQube format |
| `lcov` | lcov format |

### History Tracking

Enable coverage trend visualization:

```bash
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -historydir:"coveragehistory" \
  -reporttypes:"Html;HtmlChart"
```

In GitHub Actions, persist history across builds:

```yaml
- name: Download coverage history
  uses: dawidd6/action-download-artifact@v3
  with:
    workflow: build.yml
    name: coverage-history
    path: coveragehistory
  continue-on-error: true

- name: Generate report with history
  uses: danielpalme/ReportGenerator-GitHub-Action@5
  with:
    reports: '**/coverage.cobertura.xml'
    targetdir: 'coveragereport'
    historydir: 'coveragehistory'
    reporttypes: 'Html;HtmlChart'

- name: Upload coverage history
  uses: actions/upload-artifact@v4
  with:
    name: coverage-history
    path: coveragehistory
    retention-days: 90
```

### Badge Generation

Generate SVG badges:

```bash
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:Badges
```

Output files:
- `badge_linecoverage.svg` - Line coverage percentage
- `badge_branchcoverage.svg` - Branch coverage percentage
- `badge_methodcoverage.svg` - Method coverage percentage
- `badge_combined.svg` - Combined badge

Use in README:
```markdown
![Coverage](https://your-username.github.io/your-repo/coverage/latest/badge_linecoverage.svg)
```

### Minimum Coverage Thresholds

Fail the build if coverage drops below thresholds:

```bash
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:"Html;TextSummary" \
  -minimumCoverageThresholds:lineCoverage=80
```

Multiple thresholds:
```bash
-minimumCoverageThresholds:lineCoverage=80;branchCoverage=70;methodCoverage=90
```

### Filtering

```bash
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -assemblyfilters:"+MyProject.*;-*.Tests" \
  -classfilters:"-*Generated*" \
  -filefilters:"-*Designer.cs"
```

Filter syntax:
- `+Pattern` - Include matching items
- `-Pattern` - Exclude matching items
- Wildcards (`*`, `?`) supported
- Exclusions take precedence over inclusions

---

## 6. Complete Example Workflow

This workflow demonstrates the full pipeline: coverage collection, report generation, and GitHub Pages publishing.

```yaml
name: CI/CD with Coverage

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  release:
    types: [published]

permissions:
  contents: write
  pages: write
  id-token: write
  pull-requests: write

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Restore
        run: dotnet restore

      - name: Build
        run: dotnet build --no-restore --configuration Release

      - name: Test with coverage
        run: |
          dotnet test --no-build --configuration Release \
            --collect:"XPlat Code Coverage" \
            --results-directory TestResults

      # Download previous coverage history (for trend charts)
      - name: Download coverage history
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: ${{ github.workflow }}
          name: coverage-history
          path: coveragehistory
        continue-on-error: true

      - name: Generate coverage report
        uses: danielpalme/ReportGenerator-GitHub-Action@5
        with:
          reports: 'TestResults/**/coverage.cobertura.xml'
          targetdir: 'coveragereport'
          historydir: 'coveragehistory'
          reporttypes: 'Html;HtmlChart;Badges;MarkdownSummaryGithub;Cobertura'
          title: 'Code Coverage Report'
          tag: '${{ github.run_number }}_${{ github.sha }}'
          assemblyfilters: '+*;-*.Tests'

      # Fail if coverage is below threshold (optional)
      - name: Check coverage threshold
        run: |
          reportgenerator \
            -reports:"TestResults/**/coverage.cobertura.xml" \
            -targetdir:"threshold-check" \
            -reporttypes:TextSummary \
            "-minimumCoverageThresholds:lineCoverage=70"

      # Upload history for future runs
      - name: Upload coverage history
        uses: actions/upload-artifact@v4
        with:
          name: coverage-history
          path: coveragehistory
          retention-days: 90

      # Upload report as artifact
      - name: Upload coverage report artifact
        uses: actions/upload-artifact@v4
        with:
          name: coverage-report
          path: coveragereport

      # Add summary to PR
      - name: Add coverage PR comment
        uses: marocchino/sticky-pull-request-comment@v2
        if: github.event_name == 'pull_request'
        with:
          recreate: true
          path: coveragereport/SummaryGithub.md

      # Add to job summary
      - name: Write to job summary
        run: cat coveragereport/SummaryGithub.md >> $GITHUB_STEP_SUMMARY

  # Deploy coverage to GitHub Pages on main branch pushes
  deploy-coverage:
    needs: build-and-test
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: Download coverage report
        uses: actions/download-artifact@v4
        with:
          name: coverage-report
          path: coveragereport

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'coveragereport'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

  # Deploy versioned coverage on releases
  deploy-release-coverage:
    needs: build-and-test
    if: github.event_name == 'release'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout gh-pages
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          path: gh-pages

      - name: Download coverage report
        uses: actions/download-artifact@v4
        with:
          name: coverage-report
          path: coveragereport

      - name: Deploy versioned coverage
        run: |
          VERSION=${{ github.event.release.tag_name }}
          mkdir -p gh-pages/coverage/$VERSION
          cp -r coveragereport/* gh-pages/coverage/$VERSION/

          # Update latest
          cd gh-pages/coverage
          rm -rf latest
          cp -r $VERSION latest

          # Create index listing all versions
          cd ..
          echo "# Coverage Reports" > coverage/index.md
          echo "" >> coverage/index.md
          echo "## Latest" >> coverage/index.md
          echo "- [Latest Coverage Report](latest/index.html)" >> coverage/index.md
          echo "" >> coverage/index.md
          echo "## By Version" >> coverage/index.md
          for dir in coverage/v*/; do
            version=$(basename $dir)
            echo "- [$version]($version/index.html)" >> coverage/index.md
          done

      - name: Commit and push
        run: |
          cd gh-pages
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git diff --quiet && git diff --staged --quiet || git commit -m "Coverage for ${{ github.event.release.tag_name }}"
          git push
```

---

## Quick Reference

### Essential Commands

```bash
# Install ReportGenerator
dotnet tool install -g dotnet-reportgenerator-globaltool

# Run tests with coverage
dotnet test --collect:"XPlat Code Coverage"

# Generate HTML report
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:Html

# Generate with history and badges
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -historydir:"coveragehistory" \
  -reporttypes:"Html;HtmlChart;Badges"

# With minimum threshold
reportgenerator \
  -reports:"**/coverage.cobertura.xml" \
  -targetdir:"coveragereport" \
  -reporttypes:"Html;TextSummary" \
  -minimumCoverageThresholds:lineCoverage=80
```

### Project Setup Checklist

1. Add `coverlet.collector` to test projects
2. Install ReportGenerator as global or local tool
3. Configure `.runsettings` for coverage exclusions
4. Set up GitHub Actions workflow
5. Configure GitHub Pages deployment
6. Add coverage badge to README

---

## References

- [ReportGenerator GitHub](https://github.com/danielpalme/ReportGenerator)
- [ReportGenerator Documentation](https://reportgenerator.io/)
- [ReportGenerator GitHub Action](https://github.com/marketplace/actions/reportgenerator)
- [ReportGenerator Output Formats](https://github.com/danielpalme/ReportGenerator/wiki/Output-formats)
- [ReportGenerator Integration Guide](https://github.com/danielpalme/ReportGenerator/wiki/Integration)
- [Coverlet Documentation](https://github.com/coverlet-coverage/coverlet)
- [Microsoft Code Coverage Documentation](https://learn.microsoft.com/en-us/dotnet/core/testing/unit-testing-code-coverage)
- [GitHub Pages Documentation](https://docs.github.com/en/pages)
- [Publishing Coverage Reports with ReportGenerator (Fati Iseni)](https://fiseni.com/posts/reportgenerator-github-actions/)
- [Auto-Publish Coverage Reports (DEV Community)](https://dev.to/mbarzeev/auto-publish-your-test-coverage-report-on-github-pages-35be)
- [Nextra GitHub Pages Template](https://github.com/42arch/nextra-github-pages)
