# Custom Doc-Types

> **Status**: [DRAFT]
> **Parent**: [../doc-types.md](../doc-types.md)

---

## Overview

Projects can define additional doc-types beyond the five built-in types. Custom doc-types allow teams to capture domain-specific knowledge that doesn't fit neatly into the standard categories.

Custom doc-types are created via `/cdocs:create-type`, which generates:
1. A schema file with field definitions and classification metadata
2. A dedicated skill (`/cdocs:{name}`) for capturing that doc-type
3. Config registration for the new type

---

## Definition Structure (config.json)

Custom doc-types are registered in the project configuration:

```json
{
  "project_name": "my-project",
  "custom_doc_types": [
    {
      "name": "api-contract",
      "description": "API design decisions and contract specifications",
      "folder": "api-contracts",
      "schema_file": "./schemas/api-contract.schema.yaml",
      "skill_name": "cdocs:api-contract"
    }
  ]
}
```

---

## Schema File Structure

> **Background**: Comprehensive coverage of JSON Schema for YAML validation, including field types, validation keywords, and best practices for schema organization. See [YAML Schema Formats Research](../../research/yaml-schema-formats.md).

Each custom doc-type has a schema file (YAML) that defines:
- Required and optional frontmatter fields
- Enum values for categorical fields
- Validation rules
- **Classification metadata** for auto-invoke trigger matching

### Example Schema

```yaml
# ./csharp-compounding-docs/schemas/api-contract.schema.yaml
name: api-contract
description: API design decisions and contract specifications
folder: api-contracts

# Classification metadata - used for auto-invoke trigger matching
trigger_phrases:
  - "API endpoint"
  - "contract change"
  - "breaking change"
  - "API design"
  - "endpoint behavior"
  - "REST API"
  - "GraphQL schema"

classification_hints:
  - "HTTP method"
  - "request/response"
  - "REST"
  - "GraphQL"
  - "versioning"
  - "endpoint"
  - "payload"
  - "status code"

# Field definitions
required_fields:
  - name: endpoint
    type: string
    description: API endpoint path
  - name: change_type
    type: enum
    values: [new, breaking, non_breaking, deprecated]
    description: Type of API change

optional_fields:
  - name: http_method
    type: enum
    values: [GET, POST, PUT, PATCH, DELETE]
  - name: affected_consumers
    type: array
    description: List of known consumers affected
  - name: migration_guide
    type: string
    description: How consumers should migrate
```

---

## Classification Metadata

| Field | Purpose |
|-------|---------|
| `trigger_phrases` | Phrases that auto-trigger the `/cdocs:{name}` skill directly |
| `classification_hints` | Semantic signals (keywords, concepts) that indicate this doc-type is appropriate for the content |

### Two-Stage Classification

Trigger phrases and classification hints work **together** to reduce false positives:

1. **Trigger phrases** cast a wide net - they're intentionally broad to avoid missing relevant content
2. **Classification hints** provide semantic validation - the skill checks conversation context against these hints before prompting for capture
3. Some trigger phrases (e.g., "always", "never", "prefer" in the `style` doc-type) are generic by design. The classification hints (e.g., "convention", "naming", "formatting") help distinguish "we always use PascalCase for public methods" from "I always drink coffee in the morning"

If classification hints don't match the conversation context, the skill should NOT auto-invoke even if trigger phrases are detected.

### How Auto-Invoke Works

The same mechanism applies to both built-in and custom types:

1. Each doc-type skill independently monitors for its own `trigger_phrases`
2. When trigger phrases are detected, the `/cdocs:{name}` skill activates directly
3. `classification_hints` help the skill confirm it's the right doc-type for the content
4. If multiple skills trigger simultaneously, `/cdocs:capture-select` auto-invokes for disambiguation

---

## Generated Skills

> **Background**: Complete reference for Claude Code skill file structure, YAML frontmatter fields, invocation control, and skill discovery mechanisms. See [Building Claude Code Skills Research](../../research/building-claude-code-skills-research.md).

Each custom doc-type gets an **independent** skill generated by `/cdocs:create-type`:

| Doc-Type | Skill | Location |
|----------|-------|----------|
| `api-contract` | `/cdocs:api-contract` | `${CLAUDE_PLUGIN_ROOT}/skills/cdocs-api-contract/SKILL.md` |
| `meeting-note` | `/cdocs:meeting-note` | `${CLAUDE_PLUGIN_ROOT}/skills/cdocs-meeting-note/SKILL.md` |

### Generated Skill Capabilities

The generated skill:
- Has its own auto-invoke triggers based on `trigger_phrases` (each skill monitors independently)
- Activates directly when trigger phrases are detected - no routing through built-in capture
- Validates captured content against the custom schema
- Writes to the correct folder
- Uses `classification_hints` to confirm content appropriateness

### Design Rationale

Custom types are independent because:
- They have domain-specific triggers that shouldn't compete with built-in heuristics
- Users can create precise, targeted triggers for their workflow
- No single capture skill becomes overloaded with classification logic

See [configuration.md](./configuration.md) for additional schema file format details.

---

## Field Types

Custom schemas support the following field types:

| Type | Description | Example |
|------|-------------|---------|
| `string` | Free-form text | `description: "Brief explanation"` |
| `enum` | Constrained value from list | `values: [low, medium, high]` |
| `array` | List of strings | `tags: ["auth", "security"]` |
| `boolean` | True/false flag | `is_breaking: true` |

### Enum Fields

Enum fields require a `values` array defining valid options:

```yaml
required_fields:
  - name: priority
    type: enum
    values: [critical, high, medium, low]
    description: Task priority level
```

### Array Fields

Array fields store lists of strings:

```yaml
optional_fields:
  - name: affected_services
    type: array
    description: List of services impacted by this change
```

---

## Validation Rules

> **Background**: Evaluation of JSON Schema validation libraries for .NET, including Draft 2020-12 support and YAML integration patterns. See [JSON Schema Validation Library Research](../../research/json-schema-validation-library-research.md).

The MCP server validates documents against their schemas:

1. **Required fields**: All `required_fields` must be present in frontmatter
2. **Enum values**: Enum fields must contain one of the defined `values`
3. **Type checking**: Field values must match their declared type
4. **Common fields**: All documents must include the common required fields (`doc_type`, `title`, `date`, `summary`, `significance`)

### Validation Errors

When validation fails, the skill:
1. Reports which fields failed validation
2. Provides the expected format/values
3. Prompts for correction before saving

---

## Creating a Custom Doc-Type

### Step 1: Run the Creation Skill

```
/cdocs:create-type
```

The skill will prompt for:
- Doc-type name (kebab-case)
- Description
- Trigger phrases
- Classification hints
- Required fields
- Optional fields

### Step 2: Review Generated Files

The skill creates:
- `./csharp-compounding-docs/schemas/{name}.schema.yaml`
- `${CLAUDE_PLUGIN_ROOT}/skills/cdocs-{name}/SKILL.md`

### Step 3: Test the New Type

Capture a document using the new skill:
```
/cdocs:{name}
```

### Step 4: Iterate

Refine trigger phrases and classification hints based on:
- False positives (triggers when it shouldn't)
- False negatives (doesn't trigger when it should)

---

## Best Practices

### Trigger Phrase Design

- **Be specific**: "API contract change" is better than "change"
- **Include variations**: "endpoint", "API endpoint", "REST endpoint"
- **Avoid overlap**: Don't duplicate triggers from built-in types unless intentional

### Classification Hint Design

- **Be semantic**: Focus on concepts, not just keywords
- **Cover the domain**: Include technical terms specific to your area
- **Balance breadth and precision**: Too narrow misses content; too broad causes false positives

### Schema Design

- **Start minimal**: Begin with essential fields only
- **Add fields as needed**: Expand based on actual usage patterns
- **Use enums wisely**: Constrain values when consistency matters
- **Document descriptions**: Clear field descriptions improve capture quality
