{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://compounddocs.dev/schemas/skill-schema.json",
  "title": "CDocsSkill",
  "description": "Schema for CDocs skill definition files",
  "type": "object",
  "required": ["name", "description", "triggers"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Unique skill identifier with /cdocs: prefix",
      "pattern": "^/cdocs:[a-z][a-z0-9-]*$"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of what the skill does",
      "minLength": 10,
      "maxLength": 500
    },
    "version": {
      "type": "string",
      "description": "Semantic version of the skill",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "triggers": {
      "type": "array",
      "description": "Phrases that trigger this skill",
      "minItems": 1,
      "items": {
        "type": "string",
        "minLength": 3
      }
    },
    "parameters": {
      "type": "array",
      "description": "Parameters accepted by the skill",
      "items": {
        "$ref": "#/definitions/parameter"
      }
    },
    "tool_calls": {
      "type": "array",
      "description": "MCP tool calls to execute",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/toolCall"
      }
    },
    "output": {
      "$ref": "#/definitions/output",
      "description": "Output configuration for the skill"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata for the skill",
      "properties": {
        "author": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "category": {
          "type": "string",
          "enum": ["capture", "query", "manage", "analyze"]
        }
      }
    }
  },
  "definitions": {
    "parameter": {
      "type": "object",
      "required": ["name", "type", "description"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Parameter name (used in templates as {{name}})",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "type": {
          "type": "string",
          "description": "Parameter data type",
          "enum": ["string", "integer", "boolean", "array", "object"]
        },
        "description": {
          "type": "string",
          "description": "Human-readable parameter description"
        },
        "required": {
          "type": "boolean",
          "description": "Whether the parameter is required",
          "default": false
        },
        "default": {
          "description": "Default value if not provided"
        },
        "validation": {
          "type": "object",
          "description": "Validation rules for the parameter",
          "properties": {
            "pattern": {
              "type": "string",
              "description": "Regex pattern for validation"
            },
            "min_length": {
              "type": "integer",
              "minimum": 0
            },
            "max_length": {
              "type": "integer",
              "minimum": 1
            },
            "min": {
              "type": "number"
            },
            "max": {
              "type": "number"
            },
            "enum": {
              "type": "array",
              "description": "Allowed values"
            }
          }
        }
      }
    },
    "toolCall": {
      "type": "object",
      "required": ["tool", "arguments"],
      "properties": {
        "tool": {
          "type": "string",
          "description": "Name of the MCP tool to call"
        },
        "arguments": {
          "type": "object",
          "description": "Arguments to pass to the tool (supports {{parameter}} templates)",
          "additionalProperties": true
        },
        "condition": {
          "type": "string",
          "description": "Optional condition for executing this tool call"
        },
        "result_variable": {
          "type": "string",
          "description": "Variable name to store the result for use in subsequent calls",
          "pattern": "^[a-z][a-z0-9_]*$"
        }
      }
    },
    "output": {
      "type": "object",
      "properties": {
        "format": {
          "type": "string",
          "description": "Output format",
          "enum": ["json", "markdown", "text"],
          "default": "json"
        },
        "template": {
          "type": "string",
          "description": "Template for formatting output (supports {{variable}} placeholders)"
        },
        "include_tool_results": {
          "type": "boolean",
          "description": "Whether to include raw tool results",
          "default": true
        }
      }
    }
  }
}
